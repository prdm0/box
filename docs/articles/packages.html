<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Feature comparison • box</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Feature comparison">
<meta property="og:description" content="box">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">box</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/box.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">General topics</li>
    <li>
      <a href="../articles/testing.html">Testing modules</a>
    </li>
    <li>
      <a href="../articles/compiled-code.html">Using compiled code</a>
    </li>
    <li>
      <a href="../articles/migration.html">Migration guide for version 1.0</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Implementation details</li>
    <li>
      <a href="../articles/mod-env-hierarchy.html">The hierarchy of module environments</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="packages_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Feature comparison</h1>
                        <h4 class="author">Konrad Rudolph</h4>
            
            <h4 class="date">2021-03-21</h4>
      
      
      <div class="hidden name"><code>packages.rmd</code></div>

    </div>

    
    
<div id="design-goals" class="section level2">
<h2 class="hasAnchor">
<a href="#design-goals" class="anchor"></a>Design goals</h2>
<p>‘box’ aims to unify and entirely replace other, existing mechanisms for loading code in R. The two most notable mechanisms for this are <code>library</code> (or <code>require</code>) and <code>source</code>. In fact, neither of these mechanisms should be used in conjuction with ‘box’ — doing so defeats its purpose, and interferes with the correct functioning of ‘box’.</p>
<p>If you think you’ve found a case which requires using <code>library</code> or <code>source</code> in conjunction with ‘box’, please <a href="https://github.com/klmr/box/issues/new">let me know by submitting an issue</a>: I consider these cases to be bugs in ‘box’, and I am keen on fixing them. The only scenario that (currently) requires using a “legacy” package loading function in conjunction with ‘box’ is conditional loading; that is, <code>requireNamespace</code>.</p>
<p>There are two distinct aspects: <em>loading code</em>, and <em>writing reusable code</em>. Although these are closely related concerns, I will attempt to separate them for the purpose of the following discussion.</p>
<blockquote>
<p><strong>Note</strong> Where relevant, the following discusses the <code>library</code> function. Much the same is true for <code>require</code>; but <a href="https://stackoverflow.com/a/51263513/1968"><code>require</code> should not be used anyway</a>.</p>
</blockquote>
</div>
<div id="boxuse-vs-library" class="section level2">
<h2 class="hasAnchor">
<a href="#boxuse-vs-library" class="anchor"></a><code>box::use()</code> <em>vs</em> <code>library()</code>
</h2>
<p>The most fundamental difference between <code>library()</code> and <code>box::use()</code> is that one globally attaches all names exported from a package, and the other doesn’t. This has huge implications: causing global side-effects means that <code>library()</code> can never be used in code that needs to be isolated, so it can never be used to construct large, interconnected, modular systems.</p>
<p>That’s why <code>library()</code> mustn’t be called inside packages. Instead, packages import reusable code via a fundamentally different mechanism (namely, <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Writing-portable-packages"><code>NAMESPACE</code> declarations</a>).</p>
<p>The design rationale of ‘box’ is to allow code reuse to be isolated and controlled, so that it can be employed uniformly <em>everywhere</em>, without causing interferences elsewhere.</p>
<blockquote>
<h3 id="wip-design-rationale">[WIP] design rationale:</h3>
<ul>
<li>default is not to attach: be explicit by default</li>
<li>attaching should be fine-grained: as few names as possible in scope (see Google style guidelines, r-lib/conflicted)</li>
<li>concise syntax, otherwise it doesn’t get used</li>
<li>
<code>attach</code> happens locally</li>
<li>
<code>library</code> clearly <em>is</em> problematic, which is why packages themselves internally have a different mechanism (NAMESPACE). ‘box’ modules unify this.</li>
</ul>
<p>[WIP] ‘box’ does not warn of name conflicts when attaching, since that mechanism is a band-aid necessitated by overly broad attachment of names, and is not needed by modern module systems (case in point: only R has it, no other language sees the need).</p>
<p>[WIP] ‘pacman’</p>
<p>[WIP] Reasons for NSE:</p>
</blockquote>
<pre><code>&gt;</code></pre>
<blockquote>
<ul>
<li>Concise syntax (in particular, don’t force repeating name in assignment — refer to previous syntax, <code>foo = import('foo')</code>)</li>
<li>Encourages thinking of module dependencies of <em>static</em>, simplifying code workflow logically</li>
<li>Modules <em>are not string</em>; eschew stringly typed names</li>
</ul>
<p>[WIP] Syntax matters: nobody uses <code>library(include.only = )</code>.</p>
</blockquote>
</div>
<div id="boxuse-vs-source" class="section level2">
<h2 class="hasAnchor">
<a href="#boxuse-vs-source" class="anchor"></a><code>box::use()</code> <em>vs</em> <code>source()</code>
</h2>
<blockquote>
<p>[TODO] Merge into section on source files below?</p>
</blockquote>
</div>
<div id="modules-vs-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#modules-vs-packages" class="anchor"></a>Modules <em>vs</em> packages</h2>
<blockquote>
<h3 id="wip-design-rationale-1">[WIP] Design rationale:</h3>
<ul>
<li>encourage code reuse by making writing modules easy/“accidental”</li>
<li>modular code is naturally hierarchical; single, flat namespace is insufficient</li>
<li>(non-local) package <em>names</em> should also be namespaced, enforced for modules</li>
<li>module names are namespace qualified, prevents name collision; see coolbutuseless tweet.</li>
</ul>
<p>[WIP] packages are a too coarse unit of code organisation for large projects: either create one big package for the project, which contains many different types of unrelated functionality, and is not very easily reusable for other purposes. Violates SRP.</p>
<p>[WIP] Or need to create many small packages, each with one functionality, which all have organisational overhead, and are not hierarchically related.</p>
<p>[WIP] Shiny modules as precedence for the inadequacy of packages <a href="https://shiny.rstudio.com/articles/modules.html" class="uri">https://shiny.rstudio.com/articles/modules.html</a></p>
</blockquote>
</div>
<div id="modules-vs-source-files" class="section level2">
<h2 class="hasAnchor">
<a href="#modules-vs-source-files" class="anchor"></a>Modules <em>vs</em> source files</h2>
<blockquote>
<p>[WIP] <code>source</code> sees lots of global state, e.g. attached packages at the time of its execution (so do packages to some extent, though discouraged by R CMD check). Modules are isolated and see a consistent state of the workd, in particular, they only attach ‘base’, and they don’t need to deal with the state of the working directory due to <code>box::use</code> and <code>box::file</code> path lookup.</p>
</blockquote>
<hr>
<p>On the contrary, packages are great! The package ecosystem is probably a large reason for R’s success as a programming language. It did many things right when other languages were still dragging their feet.</p>
<p>That said, there are definitely things that can be improved about packages and how they’re used in R, and some of these things are fairly hard-wired. The following is a non-exhaustive list of things I perceive as issues large and small with packages.</p>
<p>Taken together, these issues all mean that R does not manage code complexity as well as it could: in small projects or individual analysis scripts they are not a big issue; but they become prohibitive for large software projects, and this is one of the reasons that effectively prevents R’s use for software packages above a certain size altogether.</p>
<p>I believe that ‘box’ solves all of them.</p>
</div>
<div id="packages-are-monolithic" class="section level2">
<h2 class="hasAnchor">
<a href="#packages-are-monolithic" class="anchor"></a>Packages are monolithic</h2>
<p>Compared with other languages, R packages, on average, tend to export a lot of stuff, and not always well defined around a common functionality. To be clear, there are many great single-purpose packages but, equally, there are many packages that serve as a kind of “utility bag”. This practice violates the <a href="https://en.wikipedia.org/wiki/Single-responsibility_principle">single-responsibility principle</a>: each software module should provide a single, well-defined functionality.</p>
</div>
<div id="packages-dont-support-namespaces" class="section level2">
<h2 class="hasAnchor">
<a href="#packages-dont-support-namespaces" class="anchor"></a>Packages don’t support namespaces</h2>
<p>In fact, each package in R lives in a <em>single</em> namespace. This in itself was a big achievement when it was introduced. But even when strictly observing the single-responsibility principle, it sometimes makes sense to subdivide a module into individual parts; functionality naturally composes hierarchically. R packages have no way of supporting this. Packages sometimes resort to giving names prefixes that denote different namespaces (e.g. ‘forcats’, with the <code>fct_</code> and <code>lvls_</code> prefixes) but namespaces have several advantages (such as the possibility of dropping the prefix when there’s no ambiguity).</p>
</div>
<div id="package-complexity-discourages-modularisation" class="section level2">
<h2 class="hasAnchor">
<a href="#package-complexity-discourages-modularisation" class="anchor"></a>Package complexity discourages modularisation</h2>
<p>Writing packages has become much easier over the years, largely thanks to ‘devtools’ and other utility packages. Yet wrapping existing functionality into a package is still a non-trivial process involving creating a directory hierarchy and several external configuration files. By contrast, other modern languages allow treating individual code files as packages, and consequently wrapping a piece of code into a reusable software package is as simple as saving it in a separate file. This in itself is insufficient to create a <em>distributable</em> software package, but it immediately creates modularisation within a larger project.</p>
<p>Since R packages do not have nested namespaces, such project-private packages do not exist: a software project that wants to encapsulate part of its functionality needs to create an entire stand-alone package, with no way of indicating that the resulting package is only usable as part of the parent project. As a consequence, people tend not modularise code as much as possible.</p>
</div>
<div id="library-provokes-name-clashes-and-bad-naming" class="section level2">
<h2 class="hasAnchor">
<a href="#library-provokes-name-clashes-and-bad-naming" class="anchor"></a><code>library</code> provokes name clashes and bad naming</h2>
<p>The most common way, by far, of using packages is via <code>library</code>. This imports a package and attaches all of its exported symbols globally. As a consequence, a single scope in R routinely sees hundreds or even thousands of names simultaneously (once we exclude the ‘base’ package). This makes it hard to keep track of what a given name refers to.</p>
<p>Limiting the scope of variables, limiting the number of imported symbols and keeping track of dependencies are central principles of software quality in other programming languages; so much so that some languages by default warn or signal errors when code contains unused imports, and importing unqualified names (the equivalent of <code>library</code>) is strongly discouraged (for instance, <code>from pkg import *</code> is universally frowned upon in Python).</p>
<p>Yet in R this is best practice, and the alternatives are cumbersome and usually restricted to programming in packages: the only non-manual way of importing a limited set of symbols requires placing <code>importFrom</code> declarations <em>outside of the code</em> (either in the package NAMESPACE declaration or in a Roxygen comment). The only other alternative is to always qualify the whole package name and the whole symbol name, via <code>pkg::name</code>.</p>
<p>The justified fear of name clashes sometimes unfortunately encourages bad naming to mitigate the risk. An example of this is the ‘stringr’ package, where most (but not all!) names are prefixed with <code>str_</code>. It makes using these package via explicit qualification more cumbersome because of the unhelpful redundancy it introduces (<code>stringr::str_match</code>). If R packages had proper namespacing, these prefixes wouldn’t exist.</p>
<p>Lastly, except inside a package, R has no concise way of importing names only inside a limited scope: <code>library</code> always attaches a package globally. Packages always import dependencies across the whole package. There is no way to restrict an import to an individual function (or other scope, such as an R6 class).</p>
</div>
<div id="packages-dont-support-circular-dependencies" class="section level2">
<h2 class="hasAnchor">
<a href="#packages-dont-support-circular-dependencies" class="anchor"></a>Packages don’t support circular dependencies</h2>
<p>Admittedly, this is a really minor point. Circular dependencies are inherently problematic, and avoiding them altogether is generally encouraged. Yet occasionally there is a natural circular dependency between two modules, and refactoring the code to remove the circularity would introduce non-trivial complexity. R packages do not allow this, except via “Suggests”. ???</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://klmr.me">Konrad Rudolph</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
